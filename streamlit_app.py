import streamlit as st
import time

# 1. í˜ì´ì§€ ì„¤ì • (Configuration)
# ì•±ì´ ì‹¤í–‰ë  ë•Œ ê°€ì¥ ë¨¼ì € ì„¤ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
st.set_page_config(page_title="ëŒ€ì›íƒ€ì„", page_icon="ğŸ“", layout="wide")

# 2. ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” (Initialize session state)
# 'logged_in' ìƒíƒœë¥¼ Falseë¡œ ì´ˆê¸°í™”í•˜ì—¬ ì²˜ìŒì—ëŠ” ë¡œê·¸ì¸ í™”ë©´ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
if 'logged_in' not in st.session_state:
    st.session_state.logged_in = False
if 'user_name' not in st.session_state:
    st.session_state.user_name = ""

# 3. ì£¼ìš” í•¨ìˆ˜ ì •ì˜: ë¡œê·¸ì¸ ì²˜ë¦¬
def login_attempt(username, password):
    # ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë˜ëŠ” ì¸ì¦ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
    # ì—¬ê¸°ì„œëŠ” ì„ì‹œë¡œ 'daewon'/'1234'ë¥¼ ì„±ê³µ ì¡°ê±´ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    if username == "daewon" and password == "1234":
        st.session_state.logged_in = True
        st.session_state.user_name = "ëŒ€ì›ê³  í•™ìƒ" # ì‹¤ì œ ì´ë¦„ìœ¼ë¡œ ë³€ê²½ ê°€ëŠ¥
        st.success(f"ë¡œê·¸ì¸ ì„±ê³µ! í™˜ì˜í•©ë‹ˆë‹¤, {st.session_state.user_name}ë‹˜.")
        # ì„±ê³µ ë©”ì‹œì§€ í›„ ì ì‹œ ë©ˆì·„ë‹¤ê°€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™ (Streamlit íŠ¹ì„±ìƒ í•„ìš”)
        time.sleep(0.5)
        st.experimental_rerun()
    else:
        st.error("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.")
        st.session_state.logged_in = False
        st.session_state.user_name = ""

# 4. ì£¼ìš” í•¨ìˆ˜ ì •ì˜: ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
def logout():
    st.session_state.logged_in = False
    st.session_state.user_name = ""
    st.info("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.")
    time.sleep(0.5)
    st.experimental_rerun()


# --- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ ì‹œì‘ ---

# A. ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ í™”ë©´ ë¶„ê¸°
if st.session_state.logged_in:
    # --- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ë©”ì¸ í™”ë©´ ---
    
    # ì‚¬ì´ë“œë°”ì— ì‚¬ìš©ì ì •ë³´ ë° ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í‘œì‹œ
    with st.sidebar:
        st.success(f"ì•ˆë…•í•˜ì„¸ìš”, {st.session_state.user_name}ë‹˜!")
        if st.button("ë¡œê·¸ì•„ì›ƒ", use_container_width=True):
            logout()
        st.markdown("---")
        st.header("ì•± íƒìƒ‰ ë©”ë‰´")
        # ë©”ë‰´ ì´ë¦„ì— ì˜ì–´ ì„¤ëª…ì„ ì¶”ê°€í•˜ì—¬ ëª…í™•ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.
        menu = st.radio("ë©”ë‰´ ì„ íƒ", ["ì‹œê°„í‘œ (Timetable)", "ê¸‰ì‹ ì •ë³´ (Meal Info)", "ê²Œì‹œíŒ (Board)"])
    
    st.title("ğŸ“ ëŒ€ì›íƒ€ì„ ë©”ì¸ í˜ì´ì§€")
    
    # ì»¨í…ì¸  ì˜ì—­
    if menu == "ì‹œê°„í‘œ (Timetable)":
        st.subheader("ğŸ—“ï¸ ë‚˜ì˜ ì‹œê°„í‘œ")
        st.info("ê°œì¸ ì‹œê°„í‘œë¥¼ í™•ì¸í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

        # ì‹œê°„í‘œ ì…ë ¥/ë³´ê¸° ì„¹ì…˜ì„ 2ë‹¨ìœ¼ë¡œ êµ¬ì„±
        col1, col2 = st.columns([1, 2])
        
        with col1:
            st.markdown("#### ì‹œê°„í‘œ ì…ë ¥/ì„¤ì •")
            grade = st.selectbox("í•™ë…„", [1, 2, 3])
            class_num = st.selectbox("ë°˜", list(range(1, 15)))
            
            # ì‚¬ìš©ìì—ê²Œ ì‹œê°„í‘œë¥¼ ì…ë ¥ë°›ëŠ” ì˜ˆì‹œ
            st.markdown("##### 1êµì‹œ ìˆ˜ì—… ì…ë ¥")
            # ì…ë ¥ëœ ê°’ì´ ë™ì ìœ¼ë¡œ ì‹œê°„í‘œì— ë°˜ì˜ë˜ë„ë¡ í•©ë‹ˆë‹¤.
            first_period = st.text_input(f"ì›”ìš”ì¼ 1êµì‹œ ({grade}í•™ë…„ {class_num}ë°˜)", value="êµ­ì–´")
            if st.button("ì‹œê°„í‘œ ì €ì¥"):
                st.toast("ì‹œê°„í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!", icon='âœ…')

        with col2:
            st.markdown("#### ì €ì¥ëœ ì‹œê°„í‘œ ë¯¸ë¦¬ë³´ê¸°")
            # ë°ì´í„°í”„ë ˆì„ ì˜ˆì‹œ (ì‹¤ì œ ë°ì´í„°ëŠ” ì €ì¥ëœ ê°’ìœ¼ë¡œ ëŒ€ì²´)
            st.dataframe({
                "êµì‹œ": [1, 2, 3, 4, 5, 6, 7],
                "ì›”": [first_period, "ì˜ì–´", "ê³¼í•™", "ì ì‹¬", "êµ­ì–´", "ì—­ì‚¬", "ììœ¨"],
                "í™”": ["ì²´ìœ¡", "ìˆ˜í•™", "ë¯¸ìˆ ", "ì ì‹¬", "ì˜ì–´", "ê³¼í•™", "ë™ì•„ë¦¬"],
                "ìˆ˜": ["ë¯¸ìˆ ", "ìŒì•…", "ê¸°ìˆ ", "ì ì‹¬", "ì¼ë³¸ì–´", "ìˆ˜í•™", "ì§„ë¡œ"],
                "ëª©": ["ë¬¼ë¦¬", "ì§€ë¦¬", "í™”í•™", "ì ì‹¬", "êµ­ì–´", "ì˜ì–´", "ì‚¬íšŒ"],
                "ê¸ˆ": ["ë¯¸ìˆ ", "ìŒì•…", "ê¸°ìˆ ", "ì ì‹¬", "ì¼ë³¸ì–´", "ìˆ˜í•™", "ì§„ë¡œ"],
            }, use_container_width=True)


    elif menu == "ê¸‰ì‹ ì •ë³´ (Meal Info)":
        st.subheader("ğŸš ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ì •ë³´")
        
        # ì˜¤ëŠ˜ ë‚ ì§œ (ì„ì‹œ)
        today = time.strftime("%Yë…„ %mì›” %dì¼")
        st.metric("ì˜¤ëŠ˜ ë‚ ì§œ", today)
        
        # ê¸‰ì‹ ë©”ë‰´ ìƒì„¸ ì •ë³´ (expander í™œìš©í•˜ì—¬ ê¹”ë”í•˜ê²Œ ì •ë¦¬)
        with st.expander("**[2025.01.01 ìˆ˜ìš”ì¼] ê¸‰ì‹ ë©”ë‰´ ìƒì„¸ ë³´ê¸°**", expanded=True):
            st.markdown("""
            - **ì ì‹¬ ë©”ë‰´:** ì°°í˜„ë¯¸ë°¥, ëœì¥ì°Œê°œ, ë¶ˆê³ ê¸°, ì¡ì±„, ë°°ì¶”ê¹€ì¹˜
            - **ì˜ì–‘ ì •ë³´:** (ì¹¼ë¡œë¦¬: 850kcal, ë‹¨ë°±ì§ˆ: 45g, ì§€ë°©: 30g)
            - **ì•Œë ˆë¥´ê¸°:** ì†Œê³ ê¸°(ë¶ˆê³ ê¸°), ë¼ì§€ê³ ê¸°(ì¡ì±„), ë°€(ëœì¥ì°Œê°œ) í¬í•¨
            """)
        
        # ì£¼ê°„ ê¸‰ì‹í‘œ (ì„ì‹œ ë°ì´í„°)
        st.markdown("---")
        st.markdown("#### ì´ë²ˆ ì£¼ ê¸‰ì‹ ë¯¸ë¦¬ë³´ê¸°")
        st.text("""
        ì›”: ë‹­ê°ˆë¹„ ë®ë°¥, ì½©ë‚˜ë¬¼êµ­
        í™”: ëˆê¹ŒìŠ¤, ìŠ¤í”„, ê¹ë‘ê¸°
        ìˆ˜: ë¹„ë¹”ë°¥, ê³„ë€êµ­
        ëª©: ì§œì¥ë©´, íƒ•ìˆ˜ìœ¡
        ê¸ˆ: ì¹´ë ˆë¼ì´ìŠ¤, ìƒëŸ¬ë“œ
        """)


    elif menu == "ê²Œì‹œíŒ (Board)":
        st.subheader("ğŸ’¬ ììœ  ê²Œì‹œíŒ")
        st.success("í•™ìƒë“¤ì´ ì •ë³´ë¥¼ ê³µìœ í•˜ê³  ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.")
        
        # ì„ì‹œ ê²Œì‹œíŒ ëª©ë¡ì„ í‘œ í˜•íƒœë¡œ í‘œì‹œ
        posts = [
            {"id": 1, "ì œëª©": "ì‹œí—˜ ê¸°ê°„ ììŠµì‹¤ ì´ìš© ì•ˆë‚´", "ì‘ì„±ì": "ê´€ë¦¬ì", "ë‚ ì§œ": "2025-10-28"},
            {"id": 2, "ì œëª©": "ìˆ˜í•™ ë™ì•„ë¦¬ ëª¨ì§‘ ê³µê³ ", "ì‘ì„±ì": "ìˆ˜í•™ì‚¬ë‘", "ë‚ ì§œ": "2025-10-27"},
            {"id": 3, "ì œëª©": "ì£¼ë§ì— ê°™ì´ ê³µë¶€í•  ì¹œêµ¬ êµ¬í•´ìš”", "ì‘ì„±ì": "ìŠ¤í„°ë””ì›", "ë‚ ì§œ": "2025-10-26"},
        ]
        
        st.table(posts)
        st.button("ìƒˆ ê¸€ ì‘ì„±", key="new_post_btn")

    # ì•±ì˜ ë§¨ ë§ˆì§€ë§‰ì— í‘¸í„° ë“±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    st.markdown("---")
    st.caption("Â© 2024 ëŒ€ì›íƒ€ì„ - ëŒ€ì›ê³ ë“±í•™êµ í•™ìƒìš© ì•±")

else:
    # --- ë¡œê·¸ì¸ ì‹¤íŒ¨ ë˜ëŠ” ë¯¸ë¡œê·¸ì¸ ì‹œ ë¡œê·¸ì¸ í™”ë©´ ---
    st.title("ğŸ”’ ëŒ€ì›íƒ€ì„ - ë¡œê·¸ì¸")
    st.markdown("---")
    
    # ì¤‘ì•™ ì •ë ¬ ë° í¼ í¬ê¸° ì¡°ì •ì„ ìœ„í•œ ì»¬ëŸ¼ ì‚¬ìš©
    col_empty, col_form, col_empty2 = st.columns([1, 1.5, 1])
    
    with col_form:
        st.subheader("ê³„ì • ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        
        with st.form(key='login_form'):
            username = st.text_input("ì‚¬ìš©ì ì´ë¦„ (ID)", placeholder="daewon")
            password = st.text_input("ë¹„ë°€ë²ˆí˜¸", type="password", placeholder="1234")
            
            # í¼ ì œì¶œ ë²„íŠ¼
            submit_button = st.form_submit_button(label='ë¡œê·¸ì¸', use_container_width=True)
            
            # í¼ ì œì¶œ ì‹œ ë¡œê·¸ì¸ ì‹œë„
            if submit_button:
                login_attempt(username, password)
    
    st.markdown("---")
    st.caption("í…ŒìŠ¤íŠ¸ ê³„ì •: ID 'daewon', PW '1234'")
